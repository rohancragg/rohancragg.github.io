



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
    <meta property="og:title" content=""/>
    
        <meta property="og:type" content="website"/>
    
    <meta property="og:url" content="https://rohancragg.co.uk/devops/azdo-self-hosted-build-agents/"/>
    
    
    <meta property="og:locale" content="en-GB"/>

    <meta property="base_url" content="../../../.." />
    <meta property="site_url" content="https://rohancragg.co.uk" />
    <meta property="page.url" content="./" />
    <meta property="page.abs_url" content="/devops/azdo-self-hosted-build-agents/" />
    <meta property="page.parent" content="Section(title='DevOps')" />

    
      
        <title>Azure DevOps - Self-Hosted Build Agents</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>body,input{font-family:"Noto Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="manifest" type="application/manifest+json" href="../../manifest.webmanifest" crossorigin="use-credentials">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#self-hosted-agents" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://rohancragg.co.uk" title="What I learned today (@rohancragg)" aria-label="What I learned today (@rohancragg)" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              What I learned today (@rohancragg)
            </span>
            <span class="md-header-nav__topic">
              
                Azure DevOps - Self-Hosted Build Agents
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/rohancragg/blog-notes/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    rohancragg/blog-notes
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
          


  

<div class="md-hero md-hero--expand" data-md-component="hero">
  <div class="md-hero__inner md-grid">
    Run your own Build Agents in Azure DevOps
  </div>
</div>
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://rohancragg.co.uk" title="What I learned today (@rohancragg)" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    What I learned today (@rohancragg)
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/rohancragg/blog-notes/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    rohancragg/blog-notes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="About Me" class="md-nav__link">
      About Me
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tools & Techniques
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tools & Techniques
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/scoop/" title="Scoop & Co" class="md-nav__link">
      Scoop & Co
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/git-bash/" title="Bash Shell on Windows" class="md-nav__link">
      Bash Shell on Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/misc/" title="Miscellanous Notes" class="md-nav__link">
      Miscellanous Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      DevOps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Azure DevOps - Self-Hosted Build Agents
      </label>
    
    <a href="./" title="Azure DevOps - Self-Hosted Build Agents" class="md-nav__link md-nav__link--active">
      Azure DevOps - Self-Hosted Build Agents
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#self-hosted-agents" class="md-nav__link">
    Self-Hosted Agents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-an-agent-on-ubuntu-server" class="md-nav__link">
    Configuring an agent on Ubuntu Server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-0-pre-requisites" class="md-nav__link">
    Step 0. Pre-requisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-1-create-an-account-under-which-to-run-the-agent" class="md-nav__link">
    Step 1. Create an account under which to run the Agent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-install-git2" class="md-nav__link">
    Step 2. Install Git2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-install-and-configure-the-agent" class="md-nav__link">
    Step 3. Install and configure the Agent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-run-as-a-service" class="md-nav__link">
    Step 4. Run as a Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-capabilities" class="md-nav__link">
    Installing Capabilities
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-tools" class="md-nav__link">
    Python Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-tool-cache-directory" class="md-nav__link">
    1. Create Tool Cache Directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-install-python" class="md-nav__link">
    2. Install Python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-install-conda" class="md-nav__link">
    3. Install Conda
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../compute/patching-devtestlabs/" title="VM Patching in DevTest Labs" class="md-nav__link">
      VM Patching in DevTest Labs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Kubernetes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../aks/domains/" title="Clusters and Domains" class="md-nav__link">
      Clusters and Domains
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aks/create-tls-secret/" title="Create a TLS Secret" class="md-nav__link">
      Create a TLS Secret
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#self-hosted-agents" class="md-nav__link">
    Self-Hosted Agents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-an-agent-on-ubuntu-server" class="md-nav__link">
    Configuring an agent on Ubuntu Server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-0-pre-requisites" class="md-nav__link">
    Step 0. Pre-requisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-1-create-an-account-under-which-to-run-the-agent" class="md-nav__link">
    Step 1. Create an account under which to run the Agent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-install-git2" class="md-nav__link">
    Step 2. Install Git2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-install-and-configure-the-agent" class="md-nav__link">
    Step 3. Install and configure the Agent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-run-as-a-service" class="md-nav__link">
    Step 4. Run as a Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-capabilities" class="md-nav__link">
    Installing Capabilities
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-tools" class="md-nav__link">
    Python Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-tool-cache-directory" class="md-nav__link">
    1. Create Tool Cache Directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-install-python" class="md-nav__link">
    2. Install Python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-install-conda" class="md-nav__link">
    3. Install Conda
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/rohancragg/blog-notes/edit/master/docs/devops/azdo-self-hosted-build-agents.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Azure DevOps - Self-Hosted Build Agents</h1>
                
                <h2 id="self-hosted-agents">Self-Hosted Agents<a class="headerlink" href="#self-hosted-agents" title="Permanent link">&para;</a></h2>
<details class="info"><summary>About Build Agents</summary><p>This new Learning Module has some very good explanations:</p>
<blockquote>
<p>A build agent is a system that performs build tasks. Think of it as a dedicated server that runs your build process.</p>
<p>Imagine that you have an Azure Pipelines project that receives build requests many times per day. Or perhaps you have multiple projects that can each use the same type of build agent. You can organize build agents into agent pools to help ensure that there's a server ready to process each build request.</p>
<p>When a build is triggered, Azure Pipelines selects an available build agent from the pool. If all agents are busy, the process waits for one to become available.</p>
</blockquote>
<p>from <a href="https://docs.microsoft.com/en-us/learn/modules/host-build-agent/">https://docs.microsoft.com/en-us/learn/modules/host-build-agent/</a></p>
</details>
<p>When my colleagues needed a build agent that could communicate with Azure Resources (such as Storage Accounts) inside of a private Virtual Network then the only way to do this without whitelisting a very large set of public IP address ranges (i.e. Azure Datacenter addresses) was to have a Virtual Machine running inside the same private network to which Azure DevOps would schedule build jobs.</p>
<p>Azure DevOps provides a way for you to run your own Build Agents called <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/agents?view=azure-devops"><strong>Self-hosted Agents</strong></a>.</p>
<h2 id="configuring-an-agent-on-ubuntu-server">Configuring an agent on Ubuntu Server<a class="headerlink" href="#configuring-an-agent-on-ubuntu-server" title="Permanent link">&para;</a></h2>
<p>When I learned that the requirement was to build Python wheels to be deployed. I guessed that a Linux Virtual Machine should suffice and be a bit less costly to run that a Windows Server Virtual Machine. I elected to deploy a Ubuntu Server.</p>
<p>When I looked into this I found a few blog posts in addition to <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/v2-linux?view=azure-devops">the official documentation</a>, but all the articles specified using a desktop browser to download the Agent configuration script, and this seemed very odd for Linux where I'd assumed the default mode would be to do everything at the command line so I thought I'd post here how I acheived all of this with just an SSH terminal.</p>
<h3 id="step-0-pre-requisites">Step 0. Pre-requisites<a class="headerlink" href="#step-0-pre-requisites" title="Permanent link">&para;</a></h3>
<p>Update the <code>apt</code> package manager cache</p>
<div class="codehilite"><pre><span></span><code>sudo apt-get update
</code></pre></div>

<h3 id="step-1-create-an-account-under-which-to-run-the-agent">Step 1. Create an account under which to run the Agent<a class="headerlink" href="#step-1-create-an-account-under-which-to-run-the-agent" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>sudo adduser agentsvc
sudo usermod -aG sudo agentsvc
<span class="c1"># test it</span>
su - agentsvc
sudo ls -la /root
</code></pre></div>

<h3 id="step-2-install-git2">Step 2. Install Git2<a class="headerlink" href="#step-2-install-git2" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>sudo add-apt-repository ppa:git-core/ppa
sudo apt-get update
sudo apt-get install git
</code></pre></div>

<h3 id="step-3-install-and-configure-the-agent">Step 3. Install and configure the Agent<a class="headerlink" href="#step-3-install-and-configure-the-agent" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>mkdir -p <span class="nv">$HOME</span>/Downloads <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$HOME</span>/Downloads
curl -o <span class="nv">$HOME</span>/Downloads/vsts-agent-linux-x64-2.165.0.tar.gz https://vstsagentpackage.azureedge.net/agent/2.165.0/vsts-agent-linux-x64-2.165.0.tar.gz
<span class="nb">cd</span> <span class="nv">$HOME</span>
mkdir -p <span class="nv">$HOME</span>/myagent/ <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$HOME</span>/myagent/
tar zxvf <span class="nv">$HOME</span>/Downloads/vsts-agent-linux-x64-2.165.0.tar.gz
rm -rf <span class="nv">$HOME</span>/Downloads
<span class="nb">cd</span> <span class="nv">$HOME</span>/myagent
sudo ./bin/installdependencies.sh
./config.sh
</code></pre></div>

<p>You'll see something like this and you are prompted to enter the Azure Devops Organsation ULR and a PAT token:</p>
<p><img alt="Image" src="../media/agent-config-sh.png" /></p>
<details class="tip all-in-one script"><summary>Tip</summary><p>There's an even more slick way to do the above steps here: <a href="https://github.com/MicrosoftDocs/mslearn-azure-pipelines-build-agent/blob/master/build-agent.sh">https://github.com/MicrosoftDocs/mslearn-azure-pipelines-build-agent/blob/master/build-agent.sh</a></p>
</details>
<h3 id="step-4-run-as-a-service">Step 4. Run as a Service<a class="headerlink" href="#step-4-run-as-a-service" title="Permanent link">&para;</a></h3>
<p>Now we usually want to run the agent as a service (i.e. have it run continuously waiting for job to be scheduled) so we need to do the following, <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/v2-linux?view=azure-devops#run-as-a-systemd-service">as documented here</a>.</p>
<div class="codehilite"><pre><span></span><code>sudo <span class="nv">$HOME</span>/myagent/svc.sh install
sudo <span class="nv">$HOME</span>/myagent/svc.sh start
</code></pre></div>

<hr />
<h2 id="installing-capabilities">Installing Capabilities<a class="headerlink" href="#installing-capabilities" title="Permanent link">&para;</a></h2>
<h3 id="python-tools">Python Tools<a class="headerlink" href="#python-tools" title="Permanent link">&para;</a></h3>
<p>The following is the sterling work of my colleague <a href="https://twitter.com/chyuibacca">https://twitter.com/chyuibacca</a>.</p>
<p>The aim was to install the required Python tools onto the agent so that we could run a Pipeline that includes the following Tasks:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/tool/use-python-version?view=azure-devops">UsePythonVersion@0</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/package/pip-authenticate?view=azure-devops">PipAuthenticate@1</a></li>
</ul>
<p>As well as a number of script tasks that use the <a href="https://docs.microsoft.com/en-us/python/api/overview/azure/ml/install?view=azure-ml-py">Azure Machine Learning SDK for Python</a> - also known as <code>azureml-sdk</code> (which gets installed via PyPI from <a href="https://pypi.org/project/azureml-defaults/">https://pypi.org/project/azureml-defaults/</a>)</p>
<h4 id="1-create-tool-cache-directory">1. Create Tool Cache Directory<a class="headerlink" href="#1-create-tool-cache-directory" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>mkdir -p <span class="nv">$HOME</span>/myagent/_work/_tool
</code></pre></div>

<h4 id="2-install-python">2. Install Python<a class="headerlink" href="#2-install-python" title="Permanent link">&para;</a></h4>
<p>Install tools required to build Python from source:
<div class="codehilite"><pre><span></span><code>sudo apt-get install -y make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev  libncursesw5-dev xz-utils tk-dev
</code></pre></div></p>
<p>Install required Python version (replace <code>x.y.z</code> with the required Python version, e.g. 3.6.7):
<div class="codehilite"><pre><span></span><code>wget https://www.python.org/ftp/python/3.6.7/Python-x.y.z.tgz
tar -xzf Python-x.y.z.tgz
<span class="nb">cd</span> Python-x.y.z

mkdir -p <span class="nv">$HOME</span>/myagent/_work/_tool/Python/x.y.z/x64
./configure --prefix<span class="o">=</span><span class="nv">$HOME</span>/myagent/_work/_tool/Python/x.y.z/x64/ --enable-optimizations --with-ensurepip<span class="o">=</span>install
make -j <span class="m">8</span>
sudo make altinstall
touch <span class="nv">$HOME</span>/myagent/_work/_tool/Python/x.y.z/x64.complete
</code></pre></div></p>
<p>If required, create major/ major.minor version link to latest Python version:
<div class="codehilite"><pre><span></span><code>ln -s <span class="nv">$HOME</span>/myagent/_work/_tool/Python/x/x64 <span class="nv">$HOME</span>/myagent/_work/_tool/Python/x.y.z/x64
ln -s <span class="nv">$HOME</span>/myagent/_work/_tool/Python/x.y/x64 <span class="nv">$HOME</span>/myagent/_work/_tool/Python/x.y.z/x64
</code></pre></div></p>
<h4 id="3-install-conda">3. Install Conda<a class="headerlink" href="#3-install-conda" title="Permanent link">&para;</a></h4>
<p>Install the latest Conda release:
<div class="codehilite"><pre><span></span><code>mkdir -p <span class="nv">$HOME</span>/myagent/_work/_tool/miniconda
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash ./Miniconda3-latest-Linux-x86_64.sh
</code></pre></div>
Note: When prompted, select the installation directory as <code>/home/agentsvc/myagent/_work/_tool/minconda</code></p>
<p>Initialise Conda:
<div class="codehilite"><pre><span></span><code><span class="nb">eval</span> <span class="s2">&quot;</span><span class="k">$(</span>/home/agentsvc/myagent/_work/_tool/miniconda3/bin/conda shell.bash hook<span class="k">)</span><span class="s2">&quot;</span>
conda init bash
conda config --set auto_activate_base <span class="nb">false</span>
</code></pre></div></p>
<p>Make Conda available to the agent by adding <code>/home/agentsvc/myagent/_work/_tool/miniconda3/condabin</code> to the PATH agent environment variable:
<div class="codehilite"><pre><span></span><code>vi $HOME/myagent/.path
</code></pre></div></p>
                
                  
                
                
                  
                  <hr>
                  <div class="md-source-date">
                    <small>
                      
                        Last update: 2020-03-25
                      
                    </small>
                  </div>
                
              
              
                


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://rohancragg.co.uk/devops/azdo-self-hosted-build-agents/";
      this.page.identifier =
        "/devops/azdo-self-hosted-build-agents/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//rohancragg.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../misc/misc/" title="Miscellanous Notes" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Miscellanous Notes
              </span>
            </div>
          </a>
        
        
          <a href="../../compute/patching-devtestlabs/" title="VM Patching in DevTest Labs" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                VM Patching in DevTest Labs
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 - 2020 Rohan Cragg
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://www.linkedin.com/in/rohancragg" target="_blank" rel="noopener" title="linkedin" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://twitter.com/rohancragg" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/rohancragg" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://fb.com/rohancragg" target="_blank" rel="noopener" title="facebook" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://www.instagram.com/rohancragg/" target="_blank" rel="noopener" title="instagram" class="md-footer-social__link fa fa-instagram"></a>
    
      <a href="https://asciinema.org/~rohancragg" target="_blank" rel="noopener" title="terminal" class="md-footer-social__link fa fa-terminal"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://platform.linkedin.com/badges/js/profile.js"></script>
      
    
  </body>
</html>